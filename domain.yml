version: "3.1"

intents:
  - greet
  - mood_select
  - mood_happy
  - mood_sad
  - mood_angry
  - affirm
  - deny
  - pick_reason
  - check_mood
  - restart
  - ask_question

entities:
  - mood
  - affirmation
  - denial
  - reason

slots:
  mood:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: mood
      - type: from_text
        intent: mood_select
      - type: from_intent
        intent: mood_happy
        value: happy
      - type: from_intent
        intent: mood_sad
        value: sad
      - type: from_intent
        intent: mood_angry
        value: angry

  reason:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: reason

  support_stage:
    type: text
    influence_conversation: false

  expect_free_reason:
    type: bool
    influence_conversation: false

  support_completed:
    type: bool
    influence_conversation: false

  last_mood:
    type: text
    influence_conversation: false

responses:
  utter_ask_mood_intro:
  - text: "Before we talk, can you show me how you are feeling by choosing an emoji that fits your mood? ðŸ¤”"
    buttons:
      - title: "ðŸ˜¡ Angry"
        payload: "/mood_angry{{\"mood\":\"angry\"}}"
      - title: "ðŸ˜• Sad"
        payload: "/mood_sad{{\"mood\":\"sad\"}}"
      - title: "ðŸ˜Š Happy"
        payload: "/mood_happy{{\"mood\":\"happy\"}}"

  utter_supportive_message:
    - text: "Hey there! I can help you understand your feelings and think of gentle ways to calm down, but I canâ€™t replace a real person you trust. Youâ€™re not alone, letâ€™s take it one step at a time together. ðŸ’›"

  utter_ask_mood:
    - text: "Before we talk, can you show me how you are feeling by choosing an emoji that fits your mood? ðŸ¤”"

  utter_reflect_mood_happy:
    - text: "Yay, youâ€™re feeling happy! ðŸ˜Š That makes me smile too. And if you ever have a tough moment or feel upset, you can always come back to me. Iâ€™m here for you, every single time."

  utter_reflect_mood_sad:
    - text: "Itâ€™s okay to feel sad. ðŸ’™ Thank you for trusting me and telling me. Sad feelings can feel heavy, but youâ€™re not alone, we can take this slowly together."

  utter_reflect_mood_angry:
    - text: "It sounds like you're feeling really angry right now. ðŸ˜  That's okay, big feelings can be tough to hold. I'm right here with you, and we can take some calm steps together to help your body settle down."

  utter_reason_why_you_feel_upset_question:
    - text: "Let's slow down for a moment. ðŸ’› Do you know what made you feel upset?"
      buttons:
        - title: "Yes"
          payload: '/affirm{{"affirmation":"yes"}}'
        - title: "No"
          payload: '/deny{{"denial":"no"}}'

  utter_acknowledge_uneasy_feeling:
    - text: "Thatâ€™s completely okay. ðŸ’› Sometimes our heart feels a bit heavy even if we donâ€™t really know why."

  utter_overview_common_reasons_sad:
    - text: "Here are some common reasons children might feel sad:" 
      buttons:
        - title: "I'm tired"
          payload: '/pick_reason{{"reason":"tired"}}'
        - title: "I miss someone"
          payload: '/pick_reason{{"reason":"missing_someone"}}'
        - title: "Something changed at home"
          payload: '/pick_reason{{"reason":"change_in_routine"}}'
        - title: "Worried about school"
          payload: '/pick_reason{{"reason":"worry_school"}}'
        - title: "I don't know"
          payload: '/pick_reason{{"reason":"dont_know"}}'
        # Note: removed "Continue without picking a reason" option as requested

  utter_overview_common_reasons_angry:
    - text: "Here are some common reasons children might feel angry:"
      buttons:
        - title: "I feel frustrated"
          payload: '/pick_reason{{"reason":"frustration"}}'
        - title: "Someone upset me"
          payload: '/pick_reason{{"reason":"someone_bothered_me"}}'
        - title: "I feel ignored"
          payload: '/pick_reason{{"reason":"feeling_ignored"}}'
        - title: "Loud/noisy environment"
          payload: '/pick_reason{{"reason":"overstimulation"}}'
        - title: "I don't know"
          payload: '/pick_reason{{"reason":"dont_know"}}'
        # Note: removed "Continue without picking a reason" option as requested

  utter_ask_reason_after_affirm:
    - text: "Thank you for sharing that you know why you feel {mood}. I'm listening â€” what happened?"

  utter_can_do_something_else:
    - text: "Thank you for sharing that with me. ðŸŒ¿ If you'd like, you can tell me a bit more, or we can try something gentle together to help your body calm down â€” what feels best for you right now?"

  utter_reason_unknown_exercise:
    - text: "Itâ€™s completely okay not to know. ðŸ’› Letâ€™s give your heart and body a moment to settle. How about a tiny calm break and take a slow sip of water."

  utter_reason_unknown_ask_later: 
    - text: "ðŸ’›. Sometimes it takes time to understand a feeling. If later on you start to notice what made you feel this way, you can always come back and tell me. Iâ€™ll be right here."

  utter_stage_common_ground:
    - text: "I hear that you're feeling {mood} because of {reason}. Thank you for sharing that with me â€” that took courage. We don't need to understand everything right now â€” we can just be here together, at your pace."

  utter_stage_acceptance:
    - text: "It's totally okay to feel this way. There's no need to fix or explain it. When you're ready, we can look gently at what happened to make it feel bigger. Would you like to continue?"

  utter_stage_analysis:
    - text: "Sometimes noticing small details can help. We can look together for one small thing that might have made this stronger. Would you like to continue to the next step?"

  utter_stage_nuance:
    - text: "One small reframe might help make the feeling a bit lighter. No pressure â€” it's just a gentle way to think about things differently. Shall we give it a try?"

  utter_stage_continue_question:
    - text: "Would you like to continue?"
      buttons:
        - title: "Yes"
          payload: '/affirm{{"affirmation":"yes"}}'
        - title: "Not right now"
          payload: '/deny{{"denial":"no"}}'

  utter_support_done:
    - text: "Thanks for going through that. If you ever want to do it again or explore more, Iâ€™m here for you."

  utter_support_done_check_mood:
    - text: "Thanks for going through that with me. Now that we've taken those steps, how are you feeling?"
      buttons:
        - title: "ðŸ˜¡ Angry"
          payload: "/mood_angry{{\"mood\":\"angry\"}}"
        - title: "ðŸ˜• Sad"
          payload: "/mood_sad{{\"mood\":\"sad\"}}"
        - title: "ðŸ˜Š Happy"
          payload: "/mood_happy{{\"mood\":\"happy\"}}"

  utter_followup_mood_happy:
    - text: "Iâ€™m really glad youâ€™re feeling better now. ðŸ’› If you ever want to talk again, Iâ€™ll be right here."

  utter_followup_mood_sad:
    - text: "Thank you for telling me. If youâ€™re still feeling sad, we can go gently again or take a small pause together."

  utter_followup_mood_angry:
    - text: "Thanks for sharing that youâ€™re still feeling angry. We can take another round if you want, or pause and breathe."

  utter_divider:
    - text: "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

  utter_restart_ok:
    - text: "Of course â€” we can start over. ðŸ’›"

 
actions:
  - action_start_reflect_flow
  - action_handle_reason_response
  - action_handle_pick_reason
  - action_handle_support_flow
  - action_get_stored_mood
  - action_restart_conversation
