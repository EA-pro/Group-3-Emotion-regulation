version: "3.1"

flows:

  flow_greeting_and_selecting_current_emotional_state:
    description: >
      Emotional check-in flow for children. This flow is used when the child greets
      the assistant and should be guided to choose an emoji that reflects their
      current emotional state. The assistant then acknowledges and reflects the
      selected feeling in a calm and supportive manner.
    steps:
      # Step 0) Reset mood slot at flow start
      - set_slots:
        - mood: null

      # Step 1) Send supportive message first, then intro (with emoji buttons),
      # then listen for the user's choice. Using `action_listen` lets the
      # intent/rule mapping handle the button press directly and trigger the
      # specific `utter_reflect_mood_<mood>` responses.
      - action: utter_supportive_message
      - action: utter_ask_mood_intro
      - action: action_listen

      # After the user selects a mood, trigger the custom action which will
      # dispatch the appropriate reflection utterance based on the mood slot
      - action: action_start_reflect_flow
      - action: action_listen
      # When user replies to the reason question, handle their Yes/No response
      - action: action_handle_reason_response
      - action: action_listen
      # After the user shares a reason or picks from the overview, handle it
      - action: action_handle_pick_reason
      - action: action_listen
      # Support flow - stage 1 (common_ground)
      - action: action_handle_support_flow
      - action: action_listen
      # Support flow - stage 2 (acceptance)
      - action: action_handle_support_flow
      - action: action_listen
      # Support flow - stage 3 (analysis)
      - action: action_handle_support_flow
      - action: action_listen
      # Support flow - stage 4 (nuance)
      - action: action_handle_support_flow
      - action: action_listen
      # Support flow - completion
      - action: action_handle_support_flow

  pattern_search:
    description: handle a knowledge-based question or request
    name: pattern search
    steps:
      - action: action_trigger_search      
